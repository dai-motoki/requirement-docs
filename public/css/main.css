* { margin: 0; padding: 0; box-sizing: border-box; }

/* テーマ変数 */
:root {
  --bg: #1a1a1a;
  --text: #ffffff;
  --text-weak: #b8b8b8;
  --sidebar-bg: #0f0f0f;
  --border: #2a2a2a;
  --hover: #1e1e1e;
  --selected: #2d2d2d;
  --link: #4a9eff;
  --card: #0f0f0f;
  --chip: #2d2d2d;
  --chip-hover: #3d3d3d;
  --input-bg: #1a1a1a;
  --thumb: #3a3a3a;
  --thumb-hover: #4a4a4a;
  --media-bg: #1a1a1a;
  --code-bg: #111318;
  --code-border: #2a2f3a;
  /* white-2系カード配色（ダークテーマ側） */
  --w2-top: #15181d;
  --w2-bottom: #101317;
  --w2-border: #262b33;
}
[data-theme="light"] {
  --bg: #f7f7f8;
  --text: #1a1a1a;
  --text-weak: #4a4a4a;
  --sidebar-bg: #ffffff;
  --border: #e4e4e7;
  --hover: #f3f4f6;
  --selected: #eef2ff;
  --link: #2563eb;
  --card: #ffffff;
  --chip: #eef0f4;
  --chip-hover: #e2e8f0;
  --input-bg: #ffffff;
  --thumb: #c8cbd2;
  --thumb-hover: #b8bbc6;
  --media-bg: #f2f3f7;
  --code-bg: #f6f8fa;
  --code-border: #e5e7eb;
  /* white-2系カード配色（ライトテーマ側） */
  --w2-top: #ffffff;
  --w2-bottom: #f5f7fb;
  --w2-border: #e6e9f0;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: var(--bg);
  color: var(--text);
  display: flex;
  height: 100vh;
  overflow: hidden;
}

/* サイドバー（元UIを踏襲） */
.sidebar { width: 280px; background: var(--sidebar-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; overflow: hidden; }
.sidebar-tags { flex-shrink: 0; background: var(--sidebar-bg); }
/* クイックリンク: フレックスの最下部に固定（スクロール非連動） */
.sidebar-footer { margin-top: auto; background: var(--sidebar-bg); border-top: 1px solid var(--border); }
.sidebar-header { padding: 20px; border-bottom: 1px solid var(--border); }
.sidebar-title { font-size: 1.3rem; font-weight: 600; margin-bottom: 5px; }
.sidebar-subtitle { font-size: 0.85rem; color: var(--text-weak); }

/* ツリー（元UIを踏襲） */
.folder-tree { flex: 1; overflow-y: auto; padding: 10px; }
.tree-item { user-select: none; }
.tree-label { display: flex; align-items: center; padding: 6px 8px; border-radius: 6px; transition: all 0.2s; color: var(--text-weak); cursor: pointer; }
.tree-label:hover { background: var(--hover); color: var(--text); }
.tree-label.selected { background: var(--selected); color: var(--text); }
.tree-toggle { width: 16px; height: 16px; margin-right: 8px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; color: var(--text-weak); transition: transform 0.2s; }
.tree-toggle.expanded { transform: rotate(90deg); }
.tree-name { flex: 1; font-size: 0.95rem; }
.tree-count { font-size: 0.75rem; color: var(--text-weak); margin-left: 8px; }
.tree-children { margin-left: 20px; display: none; }
.tree-children.expanded { display: block; }

/* タグ（簡易ショートカット） */
.sidebar-tags { padding: 15px; border-top: 1px solid var(--border); }
.tags-title { font-size: 0.85rem; color: var(--text-weak); margin-bottom: 10px; letter-spacing: 0.5px; }
.tag-list { display: flex; flex-wrap: wrap; gap: 6px; }
.tag { padding: 4px 10px; background: var(--chip); border-radius: 12px; font-size: 0.8rem; color: var(--text-weak); cursor: pointer; transition: all 0.2s; }
.tag:hover { background: var(--chip-hover); color: var(--text); }
.tag.active { background: var(--link); color: #fff; }

/* メイン領域（ヘッダ＋本文） */
.main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
.header-bar { display: flex; align-items: center; gap: 10px; padding: 15px 20px; background: var(--sidebar-bg); border-bottom: 1px solid var(--border); }
.menu-btn { display: none; padding: 8px 10px; background: var(--input-bg); border: 1px solid var(--border); border-radius: 6px; color: var(--text-weak); cursor: pointer; }
.search-bar { flex: 1; max-width: 520px; padding: 8px 15px; background: var(--input-bg); border: 1px solid var(--border); border-radius: 20px; color: var(--text); font-size: 0.9rem; outline: none; transition: all 0.2s; }
.search-bar:focus { border-color: var(--link); box-shadow: 0 0 0 2px color-mix(in srgb, var(--link) 20%, transparent); }
.view-options { display: flex; gap: 10px; margin-left: auto; align-items: center; }
.view-btn { padding: 8px 12px; background: var(--input-bg); border: 1px solid var(--border); border-radius: 6px; color: var(--text-weak); cursor: pointer; transition: all 0.2s; font-size: 0.9rem; }
.view-btn:hover { border-color: color-mix(in srgb, var(--border) 60%, var(--text) 40%); color: var(--text); }
.view-btn.active { background: var(--selected); border-color: var(--link); color: var(--link); }
.theme-label { color: var(--text-weak); font-size: 0.85rem; margin-right: -4px; }

/* Iconic buttons */
.icon-btn { display: inline-flex; align-items: center; gap: 6px; }
.btn-icon { display: inline-flex; width: 18px; height: 18px; color: currentColor; }
.btn-icon svg { width: 100%; height: 100%; display: block; }
.btn-label { display: inline-block; }

/* ドキュメント本文 */
.doc-container { flex: 1; overflow-y: auto; padding: 24px; }
.doc-title { font-size: 1.6rem; font-weight: 700; margin-bottom: 16px; }
.doc-meta { color: var(--text-weak); font-size: 0.9rem; margin-bottom: 18px; }
.doc-section { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 18px; margin-bottom: 16px; }
.doc-section h2 { font-size: 1.1rem; margin-bottom: 10px; }
.doc-section p, .doc-section li { color: var(--text-weak); line-height: 1.7; font-size: 0.95rem; }
.doc-section ul { margin-left: 1.2em; }
/* simple table for definitions */
table.menu-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
.menu-table th, .menu-table td { border: 1px solid var(--border); padding: 8px 10px; font-size: 0.9rem; vertical-align: top; }
.menu-table th { background: var(--sidebar-bg); color: var(--text); text-align: left; position: sticky; top: 0; }
.menu-table code { background: var(--code-bg); border: 1px solid var(--code-border); padding: 1px 4px; border-radius: 4px; }

/* セクション内画像ボックス */
.section-image { margin-top: 12px; border: 1px solid var(--border); border-radius: 12px; overflow: hidden; background: var(--media-bg); }
.section-image img { width: 100%; height: auto; display: block; cursor: zoom-in; }

/* トップ画像（ヒーロー） */
.hero { margin-bottom: 16px; border: 1px solid var(--border); border-radius: 12px; overflow: hidden; background: var(--media-bg); }
.hero img { width: 100%; display: block; }

/* 画像グリッド（元UIのグリッドを流用） */
.media-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; }
.media-item { background: var(--card); border-radius: 8px; overflow: hidden; transition: all 0.2s; border: 1px solid var(--border); }
.media-item:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
.media-thumbnail { width: 100%; height: 160px; object-fit: cover; background: var(--media-bg); display: block; }
.media-info { padding: 10px; }
.media-name { font-size: 0.85rem; color: var(--text-weak); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.media-details { font-size: 0.75rem; color: var(--text-weak); margin-top: 4px; }

/* UI遷移（Figma風） */
.flow-wrapper { margin-top: 18px; background: var(--card); border: 1px solid var(--border); border-radius: 10px; }
.flow-controls { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-bottom: 1px solid var(--border); }
.flow-controls .spacer { margin-left: auto; }
.view-options .spacer { margin-left: auto; }
.flow-viewport { position: relative; height: 560px; overflow: auto; background: repeating-linear-gradient(90deg, rgba(127,127,127,0.08) 0, rgba(127,127,127,0.08) 1px, transparent 1px, transparent 24px),
                               repeating-linear-gradient(0deg, rgba(127,127,127,0.08) 0, rgba(127,127,127,0.08) 1px, transparent 1px, transparent 24px); }
.flow-inner { position: relative; transform-origin: 0 0; }
.flow-svg { position: absolute; inset: 0; pointer-events: none; }
.nodes-layer { position: absolute; inset: 0; }
.flow-node { position: absolute; width: 220px; background: var(--sidebar-bg); border: 1px solid var(--border); border-radius: 10px; box-shadow: 0 6px 12px rgba(0,0,0,0.15); cursor: move; user-select: none; }
.flow-node img { width: 100%; height: 140px; object-fit: cover; display: block; background: var(--media-bg); border-bottom: 1px solid var(--border); }
.flow-node .title { padding: 8px 10px; font-size: 0.92rem; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.flow-label { font-size: 0.85rem; fill: var(--text); font-weight: 600; }

/* コード表示 */
pre.code { background: var(--code-bg); border: 1px solid var(--code-border); border-radius: 8px; padding: 12px; overflow: auto; font-size: 0.85rem; line-height: 1.6; }
pre.code code { color: var(--text); }

/* カード（サーバーカタログ） */
.card-grid { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 18px; }
.card { position: relative; background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 16px; transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease; box-shadow: 0 8px 24px rgba(0,0,0,0.16); display: flex; flex-direction: column; gap: 8px; overflow: hidden; }
.card:hover { transform: translateY(-3px); box-shadow: 0 12px 32px rgba(0,0,0,0.22); border-color: color-mix(in srgb, var(--border) 40%, var(--text) 60%); }
.card::after { content: ""; position: absolute; inset: 0; border-radius: 16px; pointer-events: none; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04); }
.card-title { font-weight: 800; font-size: 1rem; letter-spacing: 0.2px; }
.badge { display: inline-block; padding: 2px 8px; border-radius: 999px; font-size: 0.75rem; color: var(--text); border: 1px solid var(--border); margin-right: 6px; }
.endpoint { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size: 0.82rem; color: var(--text-weak); }
.endpoint-box { background: color-mix(in srgb, var(--input-bg) 70%, transparent); border: 1px solid var(--border); border-radius: 10px; padding: 8px 10px; }
.card ul { margin-left: 1.1em; }
/* チェック付きリスト（料金比較用） */
.checks { list-style: none; padding-left: 0; margin: 8px 0 0; }
.checks li { display: flex; gap: 10px; align-items: flex-start; padding: 6px 0; }
.checks li::before { content: '✔'; color: #22c55e; font-weight: 700; line-height: 1.2; }
.price-badge { display:inline-block; font-weight:700; font-size:.85rem; padding:4px 8px; border-radius:999px; border:1px solid var(--border); margin-bottom:6px; }
.pastel { background: linear-gradient(180deg, var(--w2-top), var(--w2-bottom)); border: 1px solid var(--w2-border); }
.pastel::before { content: ""; position: absolute; inset: -24px; background: url('../images/kamui-white-2.png') center/cover no-repeat; filter: blur(28px) saturate(1.05); opacity: 0.35; z-index: 0; }
/* 個別色のティント（各カードに --card-hue を付与） */
.pastel::after { content: ""; position: absolute; inset: 0; z-index: 0; border-radius: 16px;
  background:
    /* 右下を強く明るくするハイライト */
    radial-gradient(
      600px 420px at 100% 100%,
      hsl(var(--card-hue-b, 230) calc(var(--card-sat-b, 68%) + 6%) 97% / 0.80) 0%,
      hsl(var(--card-hue-b, 230) var(--card-sat-b, 68%) 92% / 0.55) 35%,
      transparent 65%
    ),
    /* 全体の基調グラデーション（右下が明るく） */
    linear-gradient(135deg,
      hsl(var(--card-hue-a, 210) var(--card-sat-a, 70%) var(--card-light-a, 92%) / var(--card-alpha-a, 0.65)) 0%,
      hsl(var(--card-hue-b, 230) var(--card-sat-b, 68%) var(--card-light-b, 88%) / var(--card-alpha-b, 0.65)) 100%
    );
  mix-blend-mode: normal;
}
.pastel > * { position: relative; z-index: 1; }
.pastel .card-title { color: var(--text); }
.pastel .badge { background: color-mix(in srgb, var(--w2-top) 40%, transparent); border-color: var(--w2-border); }
.pastel .endpoint-box { background: color-mix(in srgb, var(--w2-bottom) 70%, transparent); border-color: var(--w2-border); }

/* モーダル（JSONプレビュー） */
.modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 2000; }
.modal-backdrop.active { display: flex; }
.modal { width: min(900px, 90%); max-height: 80vh; background: var(--card); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; display: flex; flex-direction: column; }
.modal-header { display: flex; align-items: center; gap: 8px; padding: 10px 12px; border-bottom: 1px solid var(--border); }
.modal-title { font-weight: 700; font-size: 1rem; }
.modal-body { padding: 0; overflow: auto; background: var(--code-bg); }
.modal-body pre { margin: 0; padding: 16px; border: none; }
.modal-actions { padding: 10px 12px; border-top: 1px solid var(--border); display: flex; gap: 8px; justify-content: flex-end; }
.pastel { border: 1px solid color-mix(in srgb, var(--border) 60%, var(--text) 40%); }

/* スクロールバー */
::-webkit-scrollbar { width: 8px; height: 8px; }
::-webkit-scrollbar-track { background: var(--sidebar-bg); }
::-webkit-scrollbar-thumb { background: var(--thumb); border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: var(--thumb-hover); }

/* Mermaid図のスタイル */
.mermaid-wrapper { margin: 20px 0; padding: 20px; background: var(--code-bg); border: 1px solid var(--code-border); border-radius: 8px; overflow-x: auto; }
.mermaid { display: flex; justify-content: center; min-height: 200px; }
.mermaid-caption { text-align: center; margin-top: 10px; font-size: 0.9rem; color: var(--text-weak); }
/* Mermaid 図の矢印とラベルを濃くする（flowchart/sequence両対応の広め指定） */
.mermaid svg .edgePath path,
.mermaid svg path[marker-end],
.mermaid svg path[class*="messageLine"],
.mermaid svg line { stroke: var(--text) !important; stroke-width: 3 !important; opacity: 1 !important; }
.mermaid svg marker path,
.mermaid svg .arrowheadPath { fill: var(--text) !important; opacity: 1 !important; }
.mermaid svg .edgeLabel, .mermaid svg .label, .mermaid svg text { fill: var(--text) !important; font-weight: 800; }
.mermaid svg .edgeLabel rect, .mermaid svg .label rect { stroke: var(--border) !important; }

/* Gantt contrast overrides (reverted to theme-based) */
.mermaid svg text { fill: var(--text) !important; font-weight: 800 !important; }
.mermaid svg .grid .tick line { stroke: #64748b !important; opacity: 0.9 !important; }
.mermaid svg .task rect { fill: #4a9eff !important; stroke: #93c5fd !important; }
.mermaid svg .task .taskText, .mermaid svg .taskText { fill: #ffffff !important; }
/* Unify Gantt bar colors to match other diagrams (single blue tone) */
.mermaid svg .task.active rect { fill: #4a9eff !important; stroke: #93c5fd !important; }
.mermaid svg .task.done rect { fill: #4a9eff !important; stroke: #93c5fd !important; }
.mermaid svg .task.crit rect { fill: #4a9eff !important; stroke: #93c5fd !important; }
.mermaid svg .today { stroke: #93c5fd !important; stroke-width: 1.5px !important; }
.mermaid svg .label text { fill: var(--text) !important; }

/* ガントチャート専用 */
.gantt-wrapper { margin: 20px 0; padding: 20px; background: var(--code-bg); border: 1px solid var(--code-border); border-radius: 8px; overflow-x: auto; min-width: 100%; }
.gantt-wrapper .mermaid { display: block; min-width: 1600px !important; width: 1600px !important; min-height: 500px; }

/* モバイル最適化 */
/* デザイン要件定義用スタイル */
.color-palette { margin: 20px 0; }
.color-group { margin-bottom: 30px; }
.color-group h4 { font-size: 1rem; margin-bottom: 15px; color: var(--text); }
.color-swatches { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 12px; }
.color-swatch { 
  border-radius: 8px; 
  padding: 20px 12px; 
  text-align: center; 
  border: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  gap: 4px;
  transition: transform 0.2s;
}
.color-swatch:hover { transform: scale(1.05); }
.color-swatch.light { box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
.color-label { 
  font-size: 0.75rem; 
  font-weight: 600; 
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.color-code { 
  font-family: ui-monospace, monospace; 
  font-size: 0.85rem;
  opacity: 0.8;
}

.typography-samples { margin: 20px 0; }
.typo-item { 
  padding: 16px;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 8px;
  margin-bottom: 12px;
}
.typo-label { 
  display: block;
  font-size: 0.75rem;
  color: var(--text-weak);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 8px;
}
.typo-sample { 
  margin: 12px 0;
  color: var(--text);
}
.typo-spec { 
  display: block;
  font-family: ui-monospace, monospace;
  font-size: 0.8rem;
  color: var(--text-weak);
  margin-top: 8px;
}

.layout-specs h4,
.interaction-specs h4,
.responsive-specs h4 {
  font-size: 1rem;
  margin: 20px 0 10px;
  color: var(--text);
}

.layout-specs ul,
.interaction-specs ul,
.responsive-specs ul {
  margin-left: 1.5em;
}

/* カテゴリー別カラー */
.category-colors {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  margin: 20px 0;
}

.category-card {
  border-radius: 16px;
  overflow: hidden;
  border: 1px solid var(--border);
  transition: transform 0.3s ease;
}

.category-card:hover {
  transform: translateY(-4px);
}

.category-gradient {
  position: relative;
  padding: 40px 20px;
  color: white;
  text-align: center;
  min-height: 180px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.category-card.creative .category-gradient {
  background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 50%, #FB923C 100%);
}

.category-card.development .category-gradient {
  background: linear-gradient(135deg, #3B82F6 0%, #06B6D4 50%, #10B981 100%);
}

.category-card.business .category-gradient {
  background: linear-gradient(135deg, #10B981 0%, #14B8A6 50%, #06B6D4 100%);
}

.category-gradient h4 {
  font-size: 1.4rem;
  font-weight: 700;
  margin: 0;
  text-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.category-gradient p {
  font-size: 0.9rem;
  margin: 8px 0;
  opacity: 0.95;
}

.category-specs {
  padding: 16px;
  background: var(--card);
}

.gradient-spec {
  display: block;
  font-size: 0.85rem;
  color: var(--text-weak);
  margin-bottom: 12px;
}

.color-values {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.color-val {
  font-family: ui-monospace, monospace;
  font-size: 0.8rem;
  padding: 4px 8px;
  background: var(--chip);
  border-radius: 4px;
  color: var(--text);
}

@media (max-width: 768px) {
  body { flex-direction: column; height: 100dvh; }
  .sidebar { position: fixed; inset: 0 auto 0 0; width: min(82vw, 320px); transform: translateX(-100%); transition: transform .2s ease; z-index: 1000; box-shadow: 6px 0 24px rgba(0,0,0,0.4); }
  .sidebar.open { transform: translateX(0); }
  .sidebar-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 900; display: none; }
  .sidebar-backdrop.show { display: block; }
  .menu-btn { display: inline-block; }
  .search-bar { max-width: none; }
  .doc-container { padding: 14px; }
  .media-grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }
  .media-thumbnail { height: 120px; }
  /* 横幅を絞っても3列を維持 */
  .card-grid { grid-template-columns: repeat(3, minmax(0, 1fr)); }
  .flow-viewport { height: 60vh; }
  .view-options { gap: 6px; }
  .btn-label, .theme-label { display: none; }
  .menu-btn { padding: 8px; }
  .btn-icon { width: 20px; height: 20px; }
  
  /* デザイン要件定義モバイル対応 */
  .color-swatches { grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 8px; }
  .color-swatch { padding: 12px 8px; }
  .typo-item { padding: 12px; }
}
/* さらに狭い幅では2列へ */
@media (max-width: 640px) {
  .card-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
}
/* ごく狭い幅では1列へ */
@media (max-width: 420px) {
  .card-grid { grid-template-columns: 1fr; }
}
